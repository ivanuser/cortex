import{s as c,a as h,d as l,g as o}from"./qR_TM3YX.js";import{a as m}from"./BhtVncI_.js";import{g as W}from"./Be_uRYmX.js";const k=W(),y="cortex:activeSession";let v=c(h([])),f=c(h(typeof window<"u"&&localStorage.getItem(y)||"")),g=c(!1),u=c(""),d=c(h({activeMinutes:0,limit:100,includeGlobal:!1,includeUnknown:!1}));m.on("hello",e=>{const n=e;n.snapshot?.sessionDefaults?.mainSessionKey&&(l(u,n.snapshot.sessionDefaults.mainSessionKey,!0),o(f)||(l(f,o(u),!0),b(o(u))))});function b(e){typeof window<"u"&&localStorage.setItem(y,e)}async function C(e){if(!m.connected)return;l(g,!0);const n={...o(d),...e};try{const t={limit:n.limit,includeDerivedTitles:!0,includeLastMessage:!0};n.activeMinutes>0&&(t.activeMinutes=n.activeMinutes),n.includeGlobal&&(t.includeGlobal=!0),n.includeUnknown&&(t.includeUnknown=!0);const i=await m.call("sessions.list",t);l(v,i.sessions??i.list??[],!0)}catch(t){console.error("Failed to fetch sessions:",t),k.error("Sessions Load Failed",t instanceof Error?t.message:"Could not fetch sessions")}finally{l(g,!1)}}function T(e){l(f,e,!0),b(e)}function I(e){l(d,{...o(d),...e},!0)}const S={discord:{icon:"ðŸ’¬",name:"Discord"},telegram:{icon:"âœˆï¸",name:"Telegram"},signal:{icon:"ðŸ”’",name:"Signal"},whatsapp:{icon:"ðŸ“±",name:"WhatsApp"},slack:{icon:"ðŸ’¼",name:"Slack"},"nextcloud-talk":{icon:"â˜ï¸",name:"Nextcloud Talk"},webchat:{icon:"ðŸŒ",name:"Web Chat"},imessage:{icon:"ðŸŽ",name:"iMessage"},googlechat:{icon:"ðŸ“§",name:"Google Chat"},irc:{icon:"ðŸ“Ÿ",name:"IRC"}};function $(e,n){const t=e.split(":"),i=t.length>=3&&t[0]==="agent"?t.slice(2).join(":"):e;if(i==="main")return"ðŸ  Main Session";if(i.startsWith("cron:"))return"â° Cron Job";if(i.startsWith("subagent:"))return`ðŸ¤– Sub-agent ${i.split(":")[1]?.slice(0,8)||""}`;for(const[a,s]of Object.entries(S))if(i.startsWith(a+":")||i.startsWith(a+".")){const r=i.slice(a.length+1);if(r.startsWith("channel:"))return`${s.icon} ${s.name} Channel`;if(r.startsWith("group:"))return`${s.icon} ${s.name} Group`;if(r.startsWith("g-")){const p=r.slice(2);return/^\d{10,}$/.test(p)?`${s.icon} ${s.name} Group`:`${s.icon} ${s.name}: ${p}`}if(r.startsWith("dm:")||r.startsWith("dm-"))return`${s.icon} ${s.name} DM`;if(/^\d{10,}$/.test(r))return`${s.icon} ${s.name} Chat`;const w=r.length>20?r.slice(0,20)+"â€¦":r;return`${s.icon} ${s.name}: ${w}`}if(n){const a=S[n];if(a)return`${a.icon} ${a.name} Chat`}return null}function K(e){if(e.label)return e.label;const n=$(e.key,e.channel);if(n)return n;if(e.derivedTitle){const a=$(e.derivedTitle,e.channel);return a||e.derivedTitle}const t=e.key.split(":"),i=t.length>=3?t.slice(2).join(":"):e.key;return i.length>40?i.slice(0,40)+"â€¦":i||e.key}function A(){return{get list(){return o(v)},get activeKey(){return o(f)},get mainKey(){return o(u)},get loading(){return o(g)},get filters(){return o(d)},fetchSessions:C,setActiveSession:T,setFilters:I,getSessionTitle:K}}export{A as g};
