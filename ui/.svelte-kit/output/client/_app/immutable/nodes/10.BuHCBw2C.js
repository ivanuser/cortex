import{d as nt,a as ee,b as c,f as u,s as m,g as lt,c as ot,t as it}from"../chunks/B2A7gHtL.js";import{p as ct,s as g,a as xe,u as be,b as me,g as r,d,t as _,c as dt,e as ut,f as i,i as ge,$ as ft,h as l,r as s,n as P,j as vt}from"../chunks/qR_TM3YX.js";import{i as y}from"../chunks/DpBBTLWw.js";import{g as pt,a as te,r as re,e as he,s as ae,d as xt,i as _e,b as bt}from"../chunks/BhtVncI_.js";import{h as mt}from"../chunks/CXQ1lKJR.js";import{b as gt,a as ht}from"../chunks/nnazh41B.js";import{b as _t}from"../chunks/BYXRTvT-.js";var yt=u('<span class="font-mono text-xs text-text-muted/60"> </span>'),wt=ot('<svg class="w-3 h-3 animate-spin" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"></path></svg>'),kt=u('<div class="flex-1 flex items-center justify-center"><div class="rounded-xl border border-border-default bg-bg-secondary/50 p-8 text-center"><div class="text-text-muted text-sm">Connect to the gateway to view logs.</div></div></div>'),Lt=u('<label><input type="checkbox" class="sr-only"/> </label>'),Ct=u('<div class="rounded-lg border border-amber-500/30 bg-amber-500/5 px-3 py-1.5 text-amber-400 text-xs mb-2 flex-shrink-0">Log output truncated â€” showing latest chunk.</div>'),jt=u('<div class="rounded-lg border border-red-500/30 bg-red-500/5 px-3 py-1.5 text-red-400 text-xs mb-2 flex-shrink-0"> </div>'),Bt=u('<div class="flex items-center justify-center h-full text-text-muted/40 text-sm"> </div>'),Tt=u('<span class="w-[140px] flex-shrink-0 text-accent-purple/70 truncate"> </span>'),St=u('<span class="w-[140px] flex-shrink-0"></span>'),Ft=u('<div><span class="w-[85px] flex-shrink-0 text-text-muted/70 select-all"> </span> <span> </span> <!> <span class="flex-1 text-text-secondary break-all select-all whitespace-pre-wrap"> </span></div>'),qt=u('<div class="divide-y divide-border-default/30"></div>'),Ot=u('<span class="inline-block w-1.5 h-1.5 rounded-full bg-accent-green/60 mr-1 animate-pulse"></span> Polling every 3s',1),Rt=u('<span class="inline-block w-1.5 h-1.5 rounded-full bg-text-muted/30 mr-1"></span> Paused',1),$t=u(`<div class="flex flex-wrap items-center gap-3 mb-3 flex-shrink-0"><div class="relative flex-1 min-w-[200px] max-w-sm"><svg class="absolute left-3 top-1/2 -translate-y-1/2 w-3.5 h-3.5 text-text-muted" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg> <input placeholder="Filter logsâ€¦" class="w-full bg-bg-input border border-border-default rounded-lg pl-9 pr-3 py-2
                   text-sm text-text-primary placeholder:text-text-muted/50
                   focus:outline-none focus:border-accent-cyan focus:shadow-[0_0_8px_rgba(0,229,255,0.15)]
                   transition-all"/></div> <div class="flex items-center gap-1.5"></div> <label class="inline-flex items-center gap-1.5 text-xs text-text-muted cursor-pointer select-none ml-auto"><input type="checkbox" class="w-3.5 h-3.5 rounded border-border-default bg-bg-input accent-accent-cyan"/> Auto-scroll</label></div> <!> <!> <div class="flex-1 overflow-y-auto bg-bg-input/30 border border-border-default rounded-xl"><!></div> <div class="flex items-center justify-between mt-2 flex-shrink-0 text-[10px] text-text-muted/50 font-mono"><span><!></span> <span> <!></span></div>`,1),At=u(`<div class="h-full flex flex-col overflow-hidden"><div class="flex-1 flex flex-col max-w-full p-4 md:p-6 overflow-hidden"><div class="flex items-center justify-between mb-4 flex-shrink-0 flex-wrap gap-3"><div><h1 class="text-2xl font-bold text-text-primary flex items-center gap-3"><span class="text-accent-cyan">ðŸ“‹</span> Logs</h1> <p class="text-sm text-text-muted mt-0.5">Live gateway log tail <!></p></div> <div class="flex items-center gap-3"><span class="text-xs text-text-muted font-mono"> </span> <button class="px-3 py-2 rounded-lg text-xs border border-border-default hover:border-accent-purple
                 text-text-secondary hover:text-accent-purple transition-all
                 disabled:opacity-50 disabled:cursor-not-allowed">Export</button> <button class="px-3 py-2 rounded-lg text-xs border border-border-default hover:border-accent-cyan
                 text-text-secondary hover:text-accent-cyan transition-all
                 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-1.5"><!> Refresh</button></div></div> <!></div></div>`);function Dt(ye,we){ct(we,!0);const z=["trace","debug","info","warn","error","fatal"],ke=2e3,D=pt();let L=g(xe([])),F=g(null),H=g(null),se=g(!1),q=g(!1),T=g(null),J=g(""),ne=g(""),O=g(!0),R=g(null),$=xe({trace:!0,debug:!0,info:!0,warn:!0,error:!0,fatal:!0}),C=g(void 0);function Le(e){if(typeof e!="string")return null;const t=e.toLowerCase();return z.includes(t)?t:null}function Ce(e){if(typeof e!="string")return null;const t=e.trim();if(!t.startsWith("{")||!t.endsWith("}"))return null;try{const o=JSON.parse(t);return o&&typeof o=="object"?o:null}catch{return null}}function je(e){if(!e.trim())return{raw:e,time:null,level:null,subsystem:null,message:e};try{const t=JSON.parse(e),o=t&&typeof t._meta=="object"&&t._meta!==null?t._meta:null,v=typeof t.time=="string"?t.time:typeof o?.date=="string"?o.date:null,p=Le(o?.logLevelName??o?.level),x=typeof t[0]=="string"?t[0]:typeof o?.name=="string"?o.name:null,b=Ce(x);let j=null;b&&(j=typeof b.subsystem=="string"?b.subsystem:typeof b.module=="string"?b.module:null),!j&&x&&x.length<120&&(j=x);let B=null;return typeof t[1]=="string"?B=t[1]:!b&&typeof t[0]=="string"?B=t[0]:typeof t.message=="string"&&(B=t.message),{raw:e,time:v,level:p,subsystem:j,message:B??e}}catch{return{raw:e,time:null,level:null,subsystem:null,message:e}}}async function U(e){if(te.connected&&!(r(q)&&!e?.quiet)){e?.quiet||d(q,!0),e?.quiet||d(T,null);try{const t=await te.call("logs.tail",{cursor:e?.reset?void 0:r(F)??void 0,limit:200,maxBytes:512e3}),p=(Array.isArray(t?.lines)?t.lines:Array.isArray(t)?t:[]).filter(b=>typeof b=="string").map(je),x=!!(e?.reset||t.reset||r(F)==null);d(L,x?p:[...r(L),...p].slice(-ke),!0),(p.length>0||x)&&d(T,null),typeof t.cursor=="number"&&d(F,t.cursor,!0),typeof t.file=="string"&&d(H,t.file,!0),d(se,!!t.truncated,!0),r(O)&&p.length>0&&requestAnimationFrame(()=>{r(C)&&(r(C).scrollTop=r(C).scrollHeight)})}catch(t){d(T,String(t),!0)}finally{e?.quiet||d(q,!1)}}}function Be(){W(),d(R,setInterval(()=>{te.connected&&U({quiet:!0})},3e3),!0)}function W(){r(R)&&(clearInterval(r(R)),d(R,null))}be(()=>{const e=D.state.status;return me(()=>{e==="connected"?(U({reset:!0}).then(()=>{r(L).length===0&&!r(T)&&setTimeout(()=>U({reset:!0}),2e3)}),Be()):W()}),()=>me(()=>W())}),be(()=>{const e=r(J),t=setTimeout(()=>{d(ne,e,!0)},200);return()=>clearTimeout(t)});let A=ge(()=>{const e=r(ne).trim().toLowerCase();return r(L).filter(t=>t.level&&!$[t.level]?!1:e?[t.message,t.subsystem,t.raw].filter(Boolean).join(" ").toLowerCase().includes(e):!0)}),Te=ge(()=>z.filter(e=>!$[e]).length);function Se(){const e=r(A).map(p=>p.raw).join(`
`),t=new Blob([e],{type:"text/plain"}),o=URL.createObjectURL(t),v=document.createElement("a");v.href=o,v.download=`cortex-logs-${new Date().toISOString().slice(0,19).replace(/:/g,"-")}.txt`,v.click(),URL.revokeObjectURL(o)}function Fe(e){if(!e)return"";const t=new Date(e);return isNaN(t.getTime())?e:t.toLocaleTimeString("en-US",{hour12:!1,hour:"2-digit",minute:"2-digit",second:"2-digit",fractionalSecondDigits:3})}function qe(e){switch(e){case"trace":return"text-gray-500";case"debug":return"text-blue-400";case"info":return"text-accent-cyan";case"warn":return"text-amber-400";case"error":return"text-red-400";case"fatal":return"text-accent-pink";default:return"text-text-muted"}}function Oe(e){switch(e){case"trace":return"bg-gray-500/10";case"debug":return"bg-blue-400/10";case"info":return"bg-accent-cyan/10";case"warn":return"bg-amber-400/10";case"error":return"bg-red-400/10";case"fatal":return"bg-accent-pink/10";default:return""}}function Re(e){switch(e){case"trace":return"border-gray-500/40 text-gray-400 has-[:checked]:bg-gray-500/20 has-[:checked]:border-gray-500";case"debug":return"border-blue-400/40 text-blue-400 has-[:checked]:bg-blue-400/20 has-[:checked]:border-blue-400";case"info":return"border-accent-cyan/40 text-accent-cyan has-[:checked]:bg-accent-cyan/20 has-[:checked]:border-accent-cyan";case"warn":return"border-amber-400/40 text-amber-400 has-[:checked]:bg-amber-400/20 has-[:checked]:border-amber-400";case"error":return"border-red-400/40 text-red-400 has-[:checked]:bg-red-400/20 has-[:checked]:border-red-400";case"fatal":return"border-accent-pink/40 text-accent-pink has-[:checked]:bg-accent-pink/20 has-[:checked]:border-accent-pink"}}function $e(){if(!r(C))return;const{scrollTop:e,scrollHeight:t,clientHeight:o}=r(C);!(t-e-o<50)&&r(O)&&d(O,!1)}function Ae(e){$[e]=!$[e]}var V=At();mt("1lsf4ps",e=>{ut(()=>{ft.title="Logs â€” Cortex"})});var le=l(V),G=l(le),K=l(G),oe=i(l(K),2),Ee=i(l(oe));{var Ne=e=>{var t=yt(),o=l(t);s(t),_(()=>m(o,`â€” ${r(H)??""}`)),c(e,t)};y(Ee,e=>{r(H)&&e(Ne)})}s(oe),s(K);var ie=i(K,2),Q=l(ie),Ue=l(Q);s(Q);var X=i(Q,2),I=i(X,2),Ie=l(I);{var Me=e=>{var t=wt();c(e,t)};y(Ie,e=>{r(q)&&e(Me)})}P(),s(I),s(ie),s(G);var Pe=i(G,2);{var ze=e=>{var t=kt();c(e,t)},De=e=>{var t=$t(),o=vt(t),v=l(o),p=i(l(v),2);re(p),s(v);var x=i(v,2);he(x,21,()=>z,_e,(a,n)=>{var h=Lt(),f=l(h);re(f);var S=i(f);s(h),_(N=>{ae(h,1,`inline-flex items-center gap-1 px-2 py-1 rounded text-xs font-mono
                          border cursor-pointer transition-all select-none ${N??""}`),xt(f,$[r(n)]),m(S,` ${r(n)??""}`)},[()=>Re(r(n))]),ee("change",f,()=>Ae(r(n))),c(a,h)}),s(x);var b=i(x,2),j=l(b);re(j),P(),s(b),s(o);var B=i(o,2);{var He=a=>{var n=Ct();c(a,n)};y(B,a=>{r(se)&&a(He)})}var ce=i(B,2);{var Je=a=>{var n=jt(),h=l(n,!0);s(n),_(()=>m(h,r(T))),c(a,n)};y(ce,a=>{r(T)&&a(Je)})}var E=i(ce,2),We=l(E);{var Ve=a=>{var n=Bt(),h=l(n,!0);s(n),_(()=>m(h,r(L).length===0?"Waiting for log entriesâ€¦":"No entries match current filters")),c(a,n)},Ge=a=>{var n=qt();he(n,21,()=>r(A),_e,(h,f)=>{var S=Ft(),N=l(S),et=l(N,!0);s(N);var M=i(N,2),tt=l(M,!0);s(M);var ve=i(M,2);{var rt=w=>{var k=Tt(),Z=l(k,!0);s(k),_(()=>{bt(k,"title",r(f).subsystem),m(Z,r(f).subsystem)}),c(w,k)},at=w=>{var k=St();c(w,k)};y(ve,w=>{r(f).subsystem?w(rt):w(at,!1)})}var pe=i(ve,2),st=l(pe,!0);s(pe),s(S),_((w,k,Z)=>{ae(S,1,`virtual-item flex items-start gap-0 px-3 py-1 hover:bg-bg-hover/30 transition-colors text-xs font-mono ${w??""}`),m(et,k),ae(M,1,`w-[50px] flex-shrink-0 font-bold uppercase ${Z??""}`),m(tt,r(f).level??""),m(st,r(f).message)},[()=>Oe(r(f).level),()=>Fe(r(f).time),()=>qe(r(f).level)]),c(h,S)}),s(n),c(a,n)};y(We,a=>{r(A).length===0?a(Ve):a(Ge,!1)})}s(E),_t(E,a=>d(C,a),()=>r(C));var de=i(E,2),Y=l(de),Ke=l(Y);{var Qe=a=>{var n=Ot();P(),c(a,n)},Xe=a=>{var n=Rt();P(),c(a,n)};y(Ke,a=>{r(R)?a(Qe):a(Xe,!1)})}s(Y);var ue=i(Y,2),fe=l(ue),Ye=i(fe);{var Ze=a=>{var n=it();_(()=>m(n,`Â· Cursor: ${r(F)??""}`)),c(a,n)};y(Ye,a=>{r(F)!=null&&a(Ze)})}s(ue),s(de),_(()=>m(fe,`Buffer: ${r(L).length??""}/2000 `)),gt(p,()=>r(J),a=>d(J,a)),ht(j,()=>r(O),a=>d(O,a)),lt("scroll",E,$e),c(e,t)};y(Pe,e=>{D.state.status!=="connected"?e(ze):e(De,!1)})}s(le),s(V),_(()=>{m(Ue,`${r(A).length??""}${r(Te)>0?` / ${r(L).length}`:""} entries`),X.disabled=r(A).length===0,I.disabled=r(q)||D.state.status!=="connected"}),ee("click",X,Se),ee("click",I,()=>U({reset:!0})),c(ye,V),dt()}nt(["click","change"]);export{Dt as component};
